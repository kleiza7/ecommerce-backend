generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

/* ===========================
   ENUMS
=========================== */

enum PRODUCT_STATUS {
  NOT_APPROVED
  WAITING_FOR_APPROVE
  APPROVED
  DELETED
}

enum USER_ROLE {
  USER
  SELLER
  ADMIN
}

enum ORDER_STATUS {
  PENDING
  PAID
  COMPLETED
  CANCELED
}

/* ===========================
   MODELS
=========================== */

model Brand {
  id       Int       @id @default(autoincrement())
  name     String
  slug     String    @unique

  products Product[]

  @@map("Brands")
}

model Category {
  id           Int        @id @default(autoincrement())
  name         String
  slug         String     @unique
  description  String?
  displayOrder Int        @default(0)

  parentId     Int?       @map("parent_id")
  parent       Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  children     Category[] @relation("CategoryToCategory")

  products     Product[]

  @@index([parentId])
  @@map("Categories")
}

model Currency {
  id     Int    @id @default(autoincrement())
  code   String @unique
  symbol String

  products   Product[]
  cartItems  CartItem[]
  orderItems OrderItem[]
  orders     Order[]

  @@map("Currencies")
}

model Product {
  id          Int            @id @default(autoincrement())
  name        String
  description String
  stockCount  Int            @default(0) @map("stock_count")
  price       Decimal        @default(0.0)

  brandId     Int            @map("brand_id")
  categoryId  Int            @map("category_id")
  currencyId  Int            @map("currency_id")
  sellerId    Int            @map("seller_id")

  status      PRODUCT_STATUS @default(WAITING_FOR_APPROVE)

  brand       Brand          @relation(fields: [brandId], references: [id])
  category    Category       @relation(fields: [categoryId], references: [id])
  currency    Currency       @relation(fields: [currencyId], references: [id])
  seller      User           @relation(fields: [sellerId], references: [id])

  images      ProductImage[]
  cartItems   CartItem[]
  orderItems  OrderItem[]
  favorites   Favorite[]

  @@index([sellerId])
  @@index([status])
  @@map("Products")
}

model ProductImage {
  id          Int      @id @default(autoincrement())

  productId   Int      @map("product_id")
  product     Product  @relation(fields: [productId], references: [id])

  originalUrl String
  thumbUrl    String
  mediumUrl   String
  largeUrl    String

  publicId    String?

  isPrimary   Boolean  @default(false)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("ProductImages")
}

model User {
  id       Int       @id @default(autoincrement())
  name     String
  email    String    @unique
  password String
  role     USER_ROLE @default(USER)

  products  Product[]
  cart      Cart?
  orders    Order[]
  favorites Favorite[]

  @@map("Users")
}

model Cart {
  id       Int       @id @default(autoincrement())
  userId   Int       @unique @map("user_id")

  user     User      @relation(fields: [userId], references: [id])
  items    CartItem[]

  @@map("Carts")
}

model CartItem {
  id            Int      @id @default(autoincrement())
  cartId        Int      @map("cart_id")
  productId     Int      @map("product_id")
  currencyId    Int      @map("currency_id")
  quantity      Int      @default(1)
  priceSnapshot Decimal  @default(0.0) @map("price_snapshot")

  cart          Cart     @relation(fields: [cartId], references: [id])
  product       Product  @relation(fields: [productId], references: [id])
  currency      Currency @relation(fields: [currencyId], references: [id])

  @@unique([cartId, productId])
  @@map("CartItems")
}

model Order {
  id          Int          @id @default(autoincrement())
  userId      Int          @map("user_id")
  currencyId  Int          @map("currency_id")
  status      ORDER_STATUS @default(PENDING)
  totalPrice  Decimal      @default(0.0)

  user        User         @relation(fields: [userId], references: [id])
  currency    Currency     @relation(fields: [currencyId], references: [id])
  items       OrderItem[]

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([userId])
  @@index([status])
  @@map("Orders")
}

model OrderItem {
  id            Int      @id @default(autoincrement())
  orderId       Int      @map("order_id")
  productId     Int      @map("product_id")
  currencyId    Int      @map("currency_id")

  productName   String
  priceSnapshot Decimal  @default(0.0) @map("price_snapshot")
  quantity      Int      @default(1)

  order         Order    @relation(fields: [orderId], references: [id])
  product       Product  @relation(fields: [productId], references: [id])
  currency      Currency @relation(fields: [currencyId], references: [id])

  createdAt     DateTime @default(now())

  @@index([orderId])
  @@map("OrderItems")
}

model Favorite {
  id        Int     @id @default(autoincrement())
  userId    Int     @map("user_id")
  productId Int     @map("product_id")

  user      User    @relation(fields: [userId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  @@unique([userId, productId])
  @@map("Favorites")
}
