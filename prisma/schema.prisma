generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

model Brand {
  id       Int       @id @default(autoincrement())
  name     String
  slug     String    @unique

  products Product[]

  @@map("Brands")
}

model Category {
  id           Int        @id @default(autoincrement())
  name         String
  slug         String     @unique
  description  String?
  displayOrder Int        @default(0)

  parentId     Int?       @map("parent_id")
  parent       Category?  @relation("CategoryToCategory", fields: [parentId], references: [id])
  children     Category[] @relation("CategoryToCategory")

  products     Product[]

  @@index([parentId])
  @@map("Categories")
}

model Currency {
  id     Int    @id @default(autoincrement())
  code   String @unique // TRY, USD, EUR
  symbol String // ₺, $, €

  products Product[]

  @@map("Currencies")
}

model Product {
  id          Int       @id @default(autoincrement())
  name        String
  description String
  stockCount  Int       @default(0) @map("stock_count")
  price       Decimal   @default(0.0)

  brandId     Int       @map("brand_id")
  categoryId  Int       @map("category_id")
  currencyId  Int       @map("currency_id")

  brand       Brand     @relation(fields: [brandId], references: [id])
  category    Category  @relation(fields: [categoryId], references: [id])
  currency    Currency  @relation(fields: [currencyId], references: [id])

  cartItems   CartItem[]
  images      ProductImage[]

  @@map("Products")
}

model ProductImage {
  id          Int      @id @default(autoincrement())

  productId   Int      @map("product_id")
  product     Product  @relation(fields: [productId], references: [id])

  originalUrl String
  thumbUrl    String
  mediumUrl   String
  largeUrl    String

  publicId    String?

  isPrimary   Boolean  @default(false)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("ProductImages")
}

enum UserRole {
  USER
  SELLER
}

model User {
  id       Int      @id @default(autoincrement())
  name     String
  email    String   @unique
  password String
  role     UserRole @default(USER)

  cart     Cart?

  @@map("Users")
}

model Cart {
  id       Int       @id @default(autoincrement())
  userId   Int       @unique @map("user_id")

  user     User      @relation(fields: [userId], references: [id])
  items    CartItem[]

  @@map("Carts")
}

model CartItem {
  id            Int      @id @default(autoincrement())
  cartId        Int      @map("cart_id")
  productId     Int      @map("product_id")
  quantity      Int      @default(1)
  priceSnapshot Decimal  @default(0.0) @map("price_snapshot")

  // TODO (Phase 3):
  // - currencyId snapshot eklenmeli
  // - order / payment sırasında ürünün para birimi sabitlenmeli
  // - product.currencyId değişse bile cart/order etkilenmemeli
  // - önerilen alan:
  //   currencyId Int @map("currency_id")

  cart          Cart     @relation(fields: [cartId], references: [id])
  product       Product  @relation(fields: [productId], references: [id])

  @@map("CartItems")
}
